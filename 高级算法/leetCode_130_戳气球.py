"""
day: 2020-09-02
url: https://leetcode-cn.com/leetbook/read/top-interview-questions-hard/xdiww6/
é¢˜ç›®å: æˆ³æ°”çƒ
æœ‰nä¸ªæ°”çƒ,ç¼–å·ä¸º0åˆ°n-1,æ¯ä¸ªæ°”çƒä¸Šéƒ½æ ‡æœ‰ä¸€ä¸ªæ•°å­—,è¿™äº›æ•°å­—å­˜åœ¨æ•°ç»„numsä¸­.
ç°åœ¨è¦æ±‚ä½ æˆ³ç ´æ‰€æœ‰çš„æ°”çƒ.å¦‚æœä½ æˆ³ç ´æ°”çƒi,å°±å¯ä»¥è·å¾—nums[left]*nums[i]*nums[right]ä¸ªç¡¬å¸.è¿™é‡Œçš„leftå’Œright
ä»£è¡¨å’Œiç›¸é‚»çš„ä¸¤ä¸ªæ°”çƒçš„åºå·.æ³¨æ„å½“ä½ æˆ³ç ´äº†æ°”çƒiå,ğŸˆleftå’ŒğŸˆrightå°±å˜æˆäº†ç›¸é‚»çš„æ°”çƒ.æ±‚èƒ½è·å¾—ç¡¬å¸çš„æœ€å¤§æ•°é‡
ç¤ºä¾‹:
    è¾“å…¥: [3, 1, 5, 8]
    è¾“å‡º: 167
    è§£é‡Š: coins = 3*1*5 + 3*5*8 + 1*3*8 + 1*8*1
æ€è·¯:
    æˆ‘ä»¬æˆ³çˆ†æ°”çƒçš„æ‰€æœ‰æ”¶ç›Š,æ˜¯æˆ³çˆ†è¯¥æ°”çƒçš„æ”¶ç›Š+å·¦è¾¹æ‰€æœ‰æ°”çƒçš„æ”¶ç›Š+å³è¾¹æ‰€æœ‰æ°”çƒçš„æ”¶ç›Š
    è€Œå·¦è¾¹æ‰€æœ‰æ°”çƒçš„æ”¶ç›Š,åˆ™æ˜¯æˆ³çˆ†å·¦è¾¹æ°”çƒçš„æœ€åä¸€ä¸ªæ°”çƒå,å®ƒçš„å·¦è¾¹æ°”çƒçš„æ”¶ç›Š,ä¸å³è¾¹æ°”çƒçš„æ”¶ç›Š..
    ä¹Ÿå°±æ˜¯è¯´,æˆ‘ä»¬å¯ä»¥æŒ‰ç…§è¿™ä¸ªè§„å¾‹å°†é—®é¢˜ä¸€è·¯åˆ’åˆ†ä¸‹å»,ä»æ±‚æˆ³çˆ†æ‰€æœ‰æ°”çƒçš„æœ€å¤§æ”¶ç›Š,å‡åˆ°æ±‚æˆ³çˆ†ä¸€ä¸ªæ°”çƒçš„æœ€å¤§æ”¶ç›Š.
1. é€’å½’
    æˆ‘ä»¬åœ¨æ•°ç»„å·¦è¾¹ä¸å³è¾¹åˆ†åˆ«æ·»åŠ ä¸€ä¸ª1,æ¥æ–¹ä¾¿è®¡ç®—,ç„¶åä¸åœå¯¹ä¸€ä¸ªæŒ‡å®šçš„åŒºé—´æ±‚å®ƒçš„æœ€å¤§æ”¶ç›Š..
    æ±‚æ³•: éå†è¿™ä¸ªåŒºé—´ä¸­çš„æ‰€æœ‰æ°”çƒ,æˆ‘ä»¬å°è¯•å°†å½“å‰æ°”çƒiä½œä¸ºæœ€åä¸€ä¸ªæˆ³çˆ†çš„æ°”çƒ,é‚£ä¹ˆæˆ³çˆ†æ°”çƒiçš„æ”¶ç›Šå°±æ˜¯val[left]*val[i]*val[right],
    è€Œåœ¨è¿™ä¹‹å‰,æˆ‘ä»¬å·²ç»æˆ³çˆ†äº†å·¦è¾¹åŒºé—´çš„æ‰€æœ‰æ°”çƒ,ä¸å³è¾¹åŒºé—´çš„æ‰€æœ‰æ°”çƒ,æ‰€ä»¥æˆ‘ä»¬æœ€åæˆ³çˆ†è¿™ä¸ªæ°”çƒçš„æ€»æ”¶ç›Šåº”è¯¥æ˜¯:
        total = å·¦è¾¹åŒºé—´çš„æœ€å¤§æ”¶ç›Š+å½“å‰æ°”çƒiæ”¶ç›Š+å³è¾¹åŒºé—´çš„æœ€å¤§æ”¶ç›Š,å½“åŒºé—´çš„å·¦è¾¹ç•Œ=å³è¾¹ç•Œæ—¶,è¡¨ç¤ºæˆ‘ä»¬æ²¡æœ‰æ°”çƒå¯æˆ³äº†,è¿”å›0.
    æœ€ç»ˆæˆ‘ä»¬å–éå†ä¸­å¾—åˆ°çš„æœ€å¤§çš„total..
    åœ¨å†™é€’å½’æ—¶,æˆ‘ä»¬è¦å°†é€’å½’çš„å‡½æ•°å½“åšä¸€ä¸ªå·²ç»è¿”å›ç»“æœçš„å˜é‡.

2. åŠ¨æ€è§„åˆ’
    æ•´ä½“æ€æƒ³ä¸å˜,éƒ½æ˜¯åˆ†æ²»,å¯¹äºåŒºé—´(i, j)çš„æœ€å¤§æ”¶ç›Š,å¿…ç„¶æ˜¯æˆ³çˆ†æŸä¸ªæ°”çƒkåçš„æ”¶ç›Š,å¯¹äº
    æˆ³çˆ†æ°”çƒkçš„æ”¶ç›Š,åº”è¯¥æ˜¯ (i, k)çš„æœ€å¤§æ”¶ç›Š+kçš„æ”¶ç›Š+(k, j)çš„æ”¶ç›Š,æˆ‘ä»¬è‡ªåº•å‘ä¸Šçš„è®¡ç®—dp,
    dp[i][j]è¡¨ç¤ºå·¦è¾¹ç•Œä¸ºi,å³è¾¹ç•Œä¸ºjçš„åŒºé—´çš„æœ€å¤§æ”¶ç›Š
    é¦–å…ˆåŒ…å«0ä¸ªæ°”çƒçš„åŒºé—´å¿…ç„¶éƒ½æ˜¯0, åŒ…å«1ä¸ªæ°”çƒçš„åŒºé—´,åœ¨æˆ³çˆ†è¯¥æ°”çƒå,å®ƒçš„å·¦åŒºé—´å’Œå³åŒºé—´éƒ½æ˜¯0ä¸ªæ°”çƒçš„åŒºé—´,
    å¯ä»¥ä½¿ç”¨å·²ç»èµ‹å¥½çš„å€¼æ¥è®¡ç®—..åŒ…å«2ä¸ªæ°”çƒçš„åŒºé—´,å†æˆ³çˆ†ä¸€ä¸ªæ°”çƒå,å·¦åŒºé—´ä¸å³åŒºé—´ä¹‹é—´å¿…ç„¶æœ‰ä¸€ä¸ªåŒ…å«1ä¸ªæ°”çƒ,å°±å¯ä»¥
    åˆ©ç”¨ä¸Šä¸€æ¬¡å¾ªç¯è®¡ç®—å¥½çš„1ä¸ªæ°”çƒçš„åŒºé—´çš„æœ€å¤§æ”¶ç›Šæ¥è®¡ç®—,ä»¥æ­¤ç±»æ¨,ç›´åˆ°è®¡ç®—åŒ…å«äº†æ‰€æœ‰æ°”çƒçš„åŒºé—´,ä¹Ÿå°±æ˜¯dp[0][-1]
"""
from typing import List
from functools import lru_cache


class Solution:
    def maxCoins(self, nums: List[int]) -> int:
        n = len(nums)
        val = [1] + nums + [1]

        @lru_cache(None)
        def solve(left, right):
            # å¦‚æœå·¦è¾¹ç•Œå¤§äºç­‰äºå³è¾¹ç•Œ-1,è¯´æ˜,åŒºé—´ä¸­ä¸ä¼šæœ‰å¯æˆ³çˆ†çš„æ°”çƒ,æ”¶ç›Šä¸º0
            if left >= right - 1:
                return 0
            best = 0
            for i in range(left+1, right):
                # æœ€åä¸€ä¸ªæˆ³æœ¬æ¬¡æ°”çƒè·å¾—çš„ç¡¬å¸æ•°é‡
                total = val[left] * val[i] * val[right]
                # æˆ³åŒºé—´ä¸¤è¾¹çš„æ°”çƒèƒ½è·å¾—çš„æœ€å¤§ç¡¬å¸æ•°é‡
                total += solve(left, i) + solve(i, right)
                best = max(best, total)
            return best
        return solve(0, n+1)

    def maxCoins_dp(self, nums: List[int]) -> int:
        val = [1] + nums + [1]
        n = len(val)
        # dp[i][j]è¡¨ç¤º,åŒºé—´(i, j)æˆ³æ°”çƒèƒ½å¾—åˆ°çš„æœ€å¤§æ”¶ç›Š,æ³¨æ„æ˜¯å¼€åŒºé—´,å› ä¸º æœ€å·¦ä¾§çš„1ä¸æœ€å³ä¾§æ˜¯1æ˜¯æˆ‘ä»¬è¡¥ä¸Šå»çš„,æ˜¯ä¸èƒ½æˆ³çš„
        dp = [[0]*(n) for _ in range(n)]

        def range_best(left, right):
            # å°è¯•å°†åŒºé—´å†…çš„æ¯ä¸€ä¸ªæ°”çƒä½œä¸ºæœ€åä¸€ä¸ªæˆ³çˆ†çš„æ°”çƒ,è®¡ç®—æ”¶ç›Š
            # å–ä»–ä»¬ä¹‹é—´çš„æœ€å¤§å€¼
            for k in range(left+1, right):
                temp = dp[left][k] + val[left]*val[k]*val[right] + dp[k][right]
                dp[left][right] = max(dp[left][right], temp)
        # å¯¹äºä¸€ä¸ªä»leftåˆ°rightçš„å¼€åŒºé—´,æœ€åä¸€ä¸ªæˆ³æ°”çƒkçš„æ€»æ”¶ç›Š
        # åº”è¯¥æ˜¯dp[left][k]+val[left]*val[k]*val[right]+dp[k][right]çš„æ”¶ç›Š
        # æˆ‘ä»¬å¯ä»¥å°è¯•è¯¥åŒºé—´ä¸­çš„æ¯ä¸€ä¸ªæ°”çƒ,å°†å…¶ä½œä¸ºæœ€åä¸€ä¸ªå»æˆ³çš„æ°”çƒ,ç„¶åå–å¾—åˆ°çš„æ”¶ç›Šçš„æœ€å¤§å€¼
        # æœ€åè®¡ç®—å¾—åˆ°çš„,dp[0][-1]å°±æ˜¯ä»å¼€å§‹åˆ°ç»“å°¾ä½œä¸ºåŒºé—´çš„æœ€å¤§æ”¶ç›Š
        # å› ä¸ºæ˜¯å¼€åŒºé—´,èƒ½æˆ³æ°”çƒçš„åŒºé—´é•¿åº¦è‡³å°‘ä¸º1,é‚£ä¹ˆå³è¾¹ç•Œåº”è¯¥è‡³å°‘æ˜¯å·¦è¾¹ç•Œ+2
        for i in range(2, n):
            # è®¡ç®—è¯¥åŒºé—´çš„æœ€å¤§æ”¶ç›Š
            for j in range(0, n-i):
                range_best(j, i+j)
        return dp[0][-1]


if __name__ == "__main__":
    test = [3, 1, 5, 8]
    s = Solution()
    print(s.maxCoins_dp(test))
